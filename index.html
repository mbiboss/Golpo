<!DOCTYPE html>
<!--
  PWA BASE PATH CONFIGURATION:
  Set data-base-path to your deployment path!
  - Root deployment: data-base-path="/"
  - GitHub Pages repo: data-base-path="/repo-name/"
  - Netlify subdirectory: data-base-path="/subfolder/"
-->
<html lang="bn" data-base-path="/">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Golpo by ✿ㅤ"MʙɪㅤDᴀʀᴋ"</title>
  
  <!-- Preload critical assets -->
  <link rel="preload" href="style.css" as="style">
  <link rel="preload" href="script.js" as="script">
  <link rel="preload" href="assets/English_font.otf" as="font" type="font/otf" crossorigin>
  <link rel="preload" href="assets/Bangla_font.ttf" as="font" type="font/ttf" crossorigin>
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="style.css">
  
  <!-- Font preconnect -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Favicon for all browsers -->
  <link rel="icon" type="image/png" sizes="32x32" href="assets/logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/logo.png">
  <link rel="shortcut icon" href="assets/logo.png">
  
  <!-- Advanced Animation Libraries -->
  <link rel="stylesheet" href="animations.css">
  
  <!-- PWA Base Path Detection & Dynamic Manifest Loading -->
  <!--
    DEPLOYMENT NOTES:
    - For root deployment: Deploy to domain root, app works at /
    - For subdirectory: Deploy to subdirectory, app works at /subdirectory/
    - Configure your hosting to serve index.html for directory requests
    - GitHub Pages: Works automatically
    - Netlify: Add redirect rules if using SPA mode
  -->
  <script>
    (function() {
      // Get base path from data attribute (set in <html> tag)
      const htmlElement = document.documentElement;
      const configuredPath = htmlElement.getAttribute('data-base-path');
      let appRoot = configuredPath || '/';
      
      // Ensure appRoot ends with /
      if (!appRoot.endsWith('/')) {
        appRoot = appRoot + '/';
      }
      
      // Set base tag dynamically
      const baseTag = document.createElement('base');
      baseTag.href = appRoot;
      document.head.insertBefore(baseTag, document.head.firstChild);
      
      function getBasePath() {
        const baseElement = document.querySelector('base');
        if (baseElement && baseElement.href) {
          const base = new URL(baseElement.href);
          return base.pathname;
        }
        return appRoot;
      }
      
      const basePath = getBasePath();
      const manifestPath = basePath + 'manifest.json';
      
      // Set manifest link dynamically
      const manifestLink = document.createElement('link');
      manifestLink.rel = 'manifest';
      manifestLink.href = manifestPath;
      document.head.appendChild(manifestLink);
      
      // Set Apple touch icons dynamically
      const appleTouchIcon = document.createElement('link');
      appleTouchIcon.rel = 'apple-touch-icon';
      appleTouchIcon.href = basePath + 'assets/logo.png';
      document.head.appendChild(appleTouchIcon);
      
      // Add Apple splash screens for different device sizes
      const splashScreens = [
        { media: '(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)', size: '1290x2796' },
        { media: '(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)', size: '1179x2556' },
        { media: '(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)', size: '1284x2778' },
        { media: '(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)', size: '1170x2532' },
        { media: '(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)', size: '1125x2436' },
        { media: '(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)', size: '1242x2688' },
        { media: '(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)', size: '828x1792' },
        { media: '(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)', size: '750x1334' }
      ];
      
      splashScreens.forEach(screen => {
        const link = document.createElement('link');
        link.rel = 'apple-touch-startup-image';
        link.media = screen.media;
        link.href = basePath + 'assets/logo.png';
        document.head.appendChild(link);
      });
    })();
  </script>
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Golpo">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Golpo">
</head>

<body data-theme="dark">
  <!-- Startup/Splash Screen -->
  <div id="startupScreen" class="startup-screen">
    <div class="startup-background"></div>
    <div class="startup-content">
      <div class="startup-logo">
        <img src="https://i.postimg.cc/Rh4B24Dk/Mbi-dark.png" alt="MB Logo" class="startup-logo-img" loading="lazy"
          onerror="this.src='assets/logo.png'">
      </div>
      <div class="startup-app-name">
        <h1 class="hero-title">GOLPO</h1>
      </div>
      <div class="startup-credits">
        <p>Made by ✿ㅤ"MʙɪㅤDᴀʀᴋ"</p>
      </div>
      <div class="startup-hint">
        <p class="tap-hint">
          Tap anywhere to continue
        </p>
      </div>
    </div>
    <div class="startup-particles">
      <div class="startup-particle"></div>
      <div class="startup-particle"></div>
      <div class="startup-particle"></div>
      <div class="startup-particle"></div>
      <div class="startup-particle"></div>
    </div>
  </div>

  <!-- Background Particles -->
  <div class="particles-container">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>
  <!-- Dynamic Island Style Navigation -->
  <nav class="nav-container">
    <div class="nav-island">
      <div class="nav-left">
        <img src="https://i.postimg.cc/Rh4B24Dk/Mbi-dark.png" alt="MB Logo" class="logo" loading="lazy"
          onerror="this.src='assets/logo.png'">
        <span class="logo-text" id="logoText">Golpo</span>
      </div>

      <div class="nav-center">
        <button class="selection-btn music-selector-btn" id="musicSelector" title="Select Music">
          <i class="fas fa-music"></i>
          <span class="selector-text">Select Music</span>
        </button>

        <button id="playPauseBtn" class="control-btn" title="Play/Pause Music">
          <i class="fas fa-play icon"></i>
        </button>

        <div class="nav-progress-container" id="progressContainer" title="Reading Progress">
          <div class="nav-progress-bar">
            <div class="nav-progress-fill" id="progressFill"></div>
          </div>
          <span class="nav-progress-text" id="progressPercentage">0%</span>
        </div>
      </div>


      <div class="nav-right">
        <!-- Reading Controls Dropdown -->
        <div class="reading-controls-dropdown" id="readingControlsDropdown">
          <button class="control-btn reading-controls-btn" id="readingControlsBtn" title="Reading Controls">
            <i class="fas fa-sliders-h"></i>
          </button>
          <div class="reading-controls-menu" id="readingControlsMenu">
            <div class="control-group">
              <label class="control-label">Text Zoom & Focus</label>
              <div class="control-row">
                <button class="control-btn" id="decreaseFontBtn" title="Decrease Font Size">
                  <i class="fas fa-minus"></i>
                </button>
                <span class="font-size-display" id="fontSizeDisplay">100%</span>
                <button class="control-btn" id="increaseFontBtn" title="Increase Font Size">
                  <i class="fas fa-plus"></i>
                </button>
                <button class="control-btn mode-btn" id="focusModeBtn" title="Toggle Focus Mode">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">Auto Scroll & Go Top</label>
              <div class="control-row">
                <button class="control-btn mode-btn" id="autoScrollBtn" title="Toggle Auto Scroll">
                  <i class="fas fa-play-circle"></i>
                </button>
                <button class="control-btn" id="scrollTopBtn" title="Scroll to Top">
                  <i class="fas fa-arrow-up"></i>
                </button>
                <button class="control-btn" id="bookmarkBtn" title="Bookmark Position">
                  <i class="fas fa-bookmark"></i>
                </button>
              </div>
              <div class="auto-scroll-controls" id="autoScrollControls" style="display: none;">
                <label class="speed-label">Speed</label>
                <input type="range" id="scrollSpeedSlider" class="scroll-speed-slider" min="1" max="10" value="3" step="1">
                <div class="speed-indicators">
                  <span class="speed-indicator">Slow</span>
                  <span class="speed-indicator">Fast</span>
                </div>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">Search in Story</label>
              <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search text...">
                <button class="control-btn" id="searchBtn" title="Search">
                  <i class="fas fa-search"></i>
                </button>
                <button class="control-btn" id="clearSearchBtn" title="Clear Search">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="search-results" id="searchResults"></div>
            </div>
          </div>
        </div>

        <button id="themeToggle" class="control-btn theme-toggle" title="Toggle Theme">
          <i class="fas fa-moon icon"></i>
        </button>
      </div>
    </div>
  </nav>

  <!-- Focus Mode Exit Button -->
  <button id="focusExitBtn" class="focus-exit-btn" title="Exit Focus Mode" style="display: none;">
    <i class="fas fa-times"></i>
    <span class="progress-text">0%</span>
  </button>

  <!-- Main Content Area -->
  <main class="main-content" id="mainContent">
    <!-- Landing/Library View -->
    <div class="library-view" id="libraryView">
      <!-- Hero Section -->
      <section class="hero-section">
        <div class="hero-content">
          <h1 class="hero-title">Welcome to Golpo</h1>
          <p class="hero-subtitle">আমার নিজের লেখা গল্পঃ</p>
          <div class="hero-description english-text">
            <p>My Own Story From The Heart</p>
          </div>
          <div class="continue-reading" id="continueReading" style="display: none;">
            <button class="continue-btn" onclick="continuePreviousReading()">
              <i class="fas fa-play"></i>
              <span>Continue Reading</span>
            </button>
          </div>
        </div>
      </section>

      <!-- Story Library -->
      <section class="story-library">
        <div class="library-header">
          <h2 class="library-title english-text">Story Collection</h2>
          <div class="library-actions">
            <button class="search-toggle" onclick="toggleSearch()" aria-label="Toggle story search"
              title="Search stories">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>

        <div class="search-section" id="searchSection" style="display: none;">
          <div class="search-container">
            <input type="text" id="globalSearch" class="global-search" placeholder="Search stories...">
            <button class="search-btn" onclick="performGlobalSearch()" aria-label="Search stories" title="Search">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>

        <div class="category-filter-section" id="categoryFilterSection">
          <div class="category-filters">
            <button class="category-filter-btn active" data-category="all" onclick="filterByCategory('all')">
              <i class="fas fa-list"></i><span class="filter-text"> All Stories</span>
            </button>
            <button class="category-filter-btn" data-category="Romance" onclick="filterByCategory('Romance')">
              <i class="fas fa-heart"></i><span class="filter-text"> Romance</span>
            </button>
            <button class="category-filter-btn" data-category="Horror" onclick="filterByCategory('Horror')">
              <i class="fas fa-ghost"></i><span class="filter-text"> Horror</span>
            </button>
            <button class="category-filter-btn" data-category="Drama" onclick="filterByCategory('Drama')">
              <i class="fas fa-theater-masks"></i><span class="filter-text"> Drama</span>
            </button>
            <button class="category-filter-btn" data-category="Mystery" onclick="filterByCategory('Mystery')">
              <i class="fas fa-search"></i><span class="filter-text"> Mystery</span>
            </button>
          </div>
        </div>

        <div class="story-grid" id="storyGrid">
          <!-- Story cards will be automatically generated from stories.json -->
        </div>
        <div class="no-stories-message" id="noStoriesMessage" style="display: none;">
          <div class="no-stories-icon">
            <i class="fas fa-book-open"></i>
          </div>
          <h3>No Stories Found</h3>
          <p>There are no stories in this category yet. Try selecting a different category.</p>
        </div>
      </section>

      <!-- Footer Image Section -->
      <section class="footer-image-section">
        <img src="https://i.postimg.cc/MTvjDs38/footer.gif" alt="Footer Animation" class="footer-animation" loading="lazy">
      </section>
    </div>

    <!-- Reader View -->
    <div class="reader-view" id="readerView" style="display: none;">
      <div class="reader-header">
        <button class="back-btn" onclick="returnToLibrary()" aria-label="Return to story library"
          title="Back to Library">
          <i class="fas fa-arrow-left"></i>
          <span>Library</span>
        </button>
        <button class="toc-btn" id="tocBtn" onclick="toggleTOC()" aria-label="Table of Contents"
          title="Table of Contents" style="display: none;">
          <i class="fas fa-list-ul"></i>
          <span>Contents</span>
        </button>
        <button class="favorite-btn-reader" id="favoriteBtn" onclick="toggleCurrentStoryFavorite()" aria-label="Toggle Favorite"
          title="Add to Favorites">
          <i class="fas fa-star"></i>
          <span class="favorite-text">Favorite</span>
        </button>
        <button class="share-btn" id="shareBtn" onclick="shareCurrentStory()" aria-label="Share Story"
          title="Share Story">
          <i class="fas fa-share-alt"></i>
          <span>Share</span>
        </button>
      </div>

      <article class="story-reader">
        <header class="story-header">
          <div class="story-cover-small">
            <img id="readerCoverImage" src="" alt="Story Cover" loading="lazy" />
          </div>
          <div class="story-title-section">
            <h1 id="readerStoryTitle" class="story-title-large">Story Title</h1>
            <p id="readerAuthor" class="story-author">by ✿ㅤ"MʙɪㅤDᴀʀᴋ"</p>
            <div class="story-details">
              <span id="readerReadingTime" class="reading-time">~15 min read</span>
              <span class="divider">•</span>
              <span id="readerWordCount" class="word-count">~2,500 words</span>
            </div>
          </div>
          <div class="next-part-preview" id="nextPartPreview" style="display: none;">
            <div class="next-part-cover">
              <img id="nextPartCoverImage" src="" alt="Next Part Cover" loading="lazy" />
              <div class="next-part-overlay">
                <i class="fas fa-forward"></i>
              </div>
            </div>
            <button class="next-part-btn" id="nextPartBtn" onclick="loadNextPart()">
              <i class="fas fa-arrow-right"></i>
              <span>Next Part</span>
            </button>
          </div>
        </header>

        <div class="story-content" id="storyContent" lang="bn">
          <!-- Story content will be loaded here -->
        </div>

        <footer class="story-footer">
          <!-- Story navigation buttons removed - now only appear on last page of story -->
        </footer>
      </article>
    </div>

    <!-- Hidden Audio Player -->
    <audio id="audioPlayer" loop></audio>

    <!-- YouTube Music Player -->
    <div id="youtubePlayer" style="display: none;">
      <iframe id="youtubeFrame" width="0" height="0" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen></iframe>
    </div>
  </main>

  <!-- Story Selection Modal -->
  <div class="selection-modal" id="storyModal">
    <div class="modal-overlay" id="storyModalOverlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Choose Your Story</h3>
        <button class="modal-close" id="closeStoryModal">&times;</button>
      </div>
      <div class="selection-cards">
        <!-- Story cards are now generated dynamically from JavaScript -->
      </div>
    </div>
  </div>

  <!-- Music Selection Modal -->
  <div class="selection-modal" id="musicModal">
    <div class="modal-overlay" id="musicModalOverlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Choose Your Music</h3>
        <button class="modal-close" id="closeMusicModal">&times;</button>
      </div>
      <div class="song-playlist">
        <div class="playlist-header">
          <div class="playlist-info">
            <div class="playlist-count" id="playlistCount">Loading songs...</div>
          </div>
        </div>
        <div class="song-list" id="songList">
          <!-- Songs will be generated dynamically from JavaScript musicPlaylist array -->
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-left">
        <img src="https://i.postimg.cc/Rh4B24Dk/Mbi-dark.png" alt="MB Logo" class="footer-logo" loading="lazy"
          onerror="this.src='assets/logo.png'">
        <p class="english-text">✿ㅤ"MʙɪㅤDᴀʀᴋ &copy; 2025 Golpo. All rights reserved.</p>
      </div>

      <div class="footer-right">
        <div class="social-links">
          <a href="https://www.facebook.com/mbiboss.1/" class="social-link" title="Facebook" target="_blank"><i
              class="fab fa-facebook-f"></i></a>
          <a href="https://www.youtube.com/@Bekar_Golpo" class="social-link" title="YouTube" target="_blank"><i
              class="fab fa-youtube"></i></a>
          <a href="https://discord.com/users/731544517542674443r" class="social-link" title="Discord" target="_blank"><i
              class="fab fa-discord"></i></a>
          <a href="https://wa.me/8801317460865" class="social-link" title="WhatsApp" target="_blank"><i
              class="fab fa-whatsapp"></i></a>
          <a href="mailto:ooismailforajioo@gmail.com" class="social-link" title="Email" target="_blank"><i
              class="fas fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>

  <script src="script.js" defer></script>
  <script src="animations.js" defer></script>
</body>

</html>


<!-- Reading Statistics Modal -->
<div class="selection-modal" id="statsModal">
  <div class="modal-overlay" id="statsModalOverlay"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-chart-bar"></i> Reading Statistics</h3>
      <button class="modal-close" id="closeStatsModal">&times;</button>
    </div>
    <div class="stats-container" id="statsContainer">
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-book-reader"></i></div>
        <div class="stat-value" id="storiesRead">0</div>
        <div class="stat-label">Stories Completed</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-clock"></i></div>
        <div class="stat-value" id="totalReadingTime">0h 0m</div>
        <div class="stat-label">Total Reading Time</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-book-open"></i></div>
        <div class="stat-value" id="pagesRead">0</div>
        <div class="stat-label">Pages Read</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-fire"></i></div>
        <div class="stat-value" id="readingStreak">0</div>
        <div class="stat-label">Day Streak</div>
      </div>
    </div>
  </div>
</div>

<!-- Table of Contents Modal -->
<div class="selection-modal" id="tocModal">
  <div class="modal-overlay" id="tocModalOverlay"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-list-ul"></i> Table of Contents</h3>
      <button class="modal-close" id="closeTocModal">&times;</button>
    </div>
    <div class="toc-container" id="tocContainer">
      <p class="toc-empty english-text">No table of contents available for this story.</p>
    </div>
  </div>
</div>

<!-- Secret Analytics Dashboard -->
<div class="selection-modal" id="analyticsModal">
  <div class="modal-overlay" id="analyticsModalOverlay"></div>
  <div class="modal-content analytics-modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-lock"></i> Secret Analytics Dashboard</h3>
      <button class="modal-close" id="closeAnalyticsModal">&times;</button>
    </div>
    <div class="analytics-dashboard" id="analyticsDashboard">
      <div class="analytics-section">
        <h4 class="analytics-title english-text">Reading Behavior</h4>
        <div class="analytics-grid">
          <div class="analytics-card">
            <div class="analytics-icon"><i class="fas fa-tachometer-alt"></i></div>
            <div class="analytics-value" id="avgReadingSpeed">0</div>
            <div class="analytics-label">Words/Min</div>
          </div>
          <div class="analytics-card">
            <div class="analytics-icon"><i class="fas fa-hourglass-half"></i></div>
            <div class="analytics-value" id="avgSessionTime">0</div>
            <div class="analytics-label">Avg Session</div>
          </div>
          <div class="analytics-card">
            <div class="analytics-icon"><i class="fas fa-chart-line"></i></div>
            <div class="analytics-value" id="completionRate">0%</div>
            <div class="analytics-label">Completion Rate</div>
          </div>
        </div>
      </div>
      <div class="analytics-section">
        <h4 class="analytics-title english-text"><i class="fas fa-star"></i> Favorite Stories</h4>
        <div class="favorite-stories-list" id="favoriteStoriesList">
          <p class="english-text" style="text-align: center; color: var(--text-muted); padding: 1rem;">No favorite stories yet. Mark stories as favorite to see them here!</p>
        </div>
      </div>
      <div class="analytics-section">
        <h4 class="analytics-title english-text"><i class="fas fa-book-open"></i> Recently Read</h4>
        <div class="recently-read-list" id="recentlyReadList">
          <p class="english-text" style="text-align: center; color: var(--text-muted); padding: 1rem;">No recent reading activity</p>
        </div>
      </div>
      <div class="analytics-section">
        <h4 class="analytics-title english-text"><i class="fas fa-music"></i> Recently Played Songs</h4>
        <div class="recently-played-list" id="recentlyPlayedList">
          <p class="english-text" style="text-align: center; color: var(--text-muted); padding: 1rem;">No songs played yet</p>
        </div>
      </div>
      <div class="analytics-section">
        <h4 class="analytics-title english-text"><i class="fas fa-clock"></i> Reading Time Per Story</h4>
        <div class="reading-time-list" id="readingTimeList">
          <p class="english-text" style="text-align: center; color: var(--text-muted); padding: 1rem;">Start reading to track your time!</p>
        </div>
      </div>
      <div class="analytics-section">
        <h4 class="analytics-title english-text"><i class="fas fa-history"></i> Activity Timeline</h4>
        <div class="analytics-timeline" id="analyticsTimeline">
          <p class="english-text" style="text-align: center; color: var(--text-muted);">Recent activity will appear here</p>
        </div>
      </div>
    </div>
  </div>
</div>
